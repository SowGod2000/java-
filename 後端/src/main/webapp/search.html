<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>會員資料展示</title>
<style>
/* 使用 Flexbox 使元素並排顯示 */
.header-container {
	display: flex;
	justify-content: space-between; /* 讓元素兩端對齊 */
	align-items: center; /* 讓元素垂直居中 */
}
</style>
</head>
<body>

	<div class="header-container">
		<h1>會員資料</h1>
		<button id="logout-btn">Logout</button>
	</div>

	<!-- 表單用於輸入查詢條件 -->
	<form id="search-form">
		<input type="text" id="name" placeholder="姓名"> <input
			type="text" id="phone" placeholder="電話"> <input type="email"
			id="email" placeholder="電子郵件">
		<button type="submit">查詢</button>
	</form>

	<h2>會員列表</h2>
	<table id="member-table" border="1">
		<thead>
			<tr>
				<th>姓名</th>
				<th>電話</th>
				<th>電子郵件</th>
				<th>操作</th>
			</tr>
		</thead>
		<tbody>
			<!-- 會員資料會顯示在這裡 -->
		</tbody>
	</table>

	<script>
    
        const apiUrl = 'http://localhost:8080/Member/search';

 const token = localStorage.getItem('jwt');

        if (!token) {
            // 如果沒有 token，跳轉到登入頁面
            window.location.href = 'login.html';
        } else {
        // 表單提交事件
        document.getElementById('search-form').addEventListener('submit', function(event) {
            event.preventDefault();  // 防止表單默認提交

            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const email = document.getElementById('email').value;

            const params = new URLSearchParams();
            if (name) params.append('name', name);
            if (phone) params.append('phone', phone);
            if (email) params.append('email', email);

            fetch(`${apiUrl}?${params.toString()}`, { method: 'GET' })
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.getElementById('member-table').getElementsByTagName('tbody')[0];
                    tableBody.innerHTML = '';  // 清空現有的資料

                    // 顯示會員資料
                    data.forEach(member => {
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                            <td>${member.name}</td>
                            <td>${member.phone}</td>
                            <td>${member.email}</td>
                            <td>
                                <button onclick="editMember(${member.memberID})">修改</button>
                                <button onclick="deleteMember(${member.memberID})">刪除</button>
                            </td>
                        `;
                        tableBody.appendChild(tr);
                    });
                })
                .catch(error => {
                    console.error('錯誤：', error);
                });
        });

        // 修改會員資料
        function editMember(memberID) {
            window.location.href = `update.html?id=${memberID}`;
            // 這裡可以做跳轉或者打開一個表單讓用戶修改資料
        }

        // 刪除會員資料
        function deleteMember(memberID) {
            if (confirm('確定要刪除此會員嗎？')) {
                fetch(`http://localhost:8080/Member/delete?memberID=${memberID}`, 
                {
                    method: 'DELETE',
                })
                .then(response => {
                    if (response.ok) {
                        alert('會員已刪除');
                        location.reload();  // 重新載入頁面
                    } else {
                        alert('刪除失敗');
                    }
                })
                .catch(error => {
                    console.error('刪除錯誤：', error);
                });
            }
        }
         document.getElementById('logout-btn').addEventListener('click', () => {
            // 刪除本地存儲的 JWT Token
            localStorage.removeItem('jwt');

            // 重定向到登入頁面
            window.location.href = 'login.html';
        });
        }
    </script>

</body>
</html>
