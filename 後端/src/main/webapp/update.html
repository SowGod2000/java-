<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>修改會員資料</title>
</head>
<body>

    <h1>修改會員資料</h1>

    <form id="update-form">
        <input type="hidden" id="memberId" name="memberId">  <!-- 隱藏會員 ID -->
        <div>
            <label for="name">姓名</label>
            <input type="text" id="name" name="name" required>
        </div>
        <div>
            <label for="phone">電話</label>
            <input type="text" id="phone" name="phone" required>
        </div>
        <div>
            <label for="email">電子郵件</label>
            <input type="email" id="email" name="email" required>
        </div>
        <div>
            <label for="birthDate">生日</label>
            <input type="text" id="birthDate" name="birthDate" required>
        </div>
        <div>
            <label for="address">地址</label>
            <input type="text" id="address" name="address" required>
        </div>
        <div>
            <label for="idCard">身份證字號</label>
            <input type="text" id="idCard" name="idCard" required>
        </div>
        <div>
            <label for="password">密碼</label>
            <input type="password" id="password" name="password" required>
        </div>
        <button type="submit">修改資料</button>
    </form>

    <script>
        // 獲取 URL 參數中的會員 ID
        const urlParams = new URLSearchParams(window.location.search);
        const memberId = urlParams.get('id');

        // 讀取會員資料
        const apiUrl = `http://localhost:8080/Member/${memberId}`;
        //更新資料
         const apiUrl2 = `http://localhost:8080/Member/update/${memberId}`;
       

        fetch(apiUrl)
            .then(response => response.json())
            .then(member => {
                document.getElementById('memberId').value = member.memberID;
                document.getElementById('name').value = member.name;
                document.getElementById('phone').value = member.phone;
                document.getElementById('email').value = member.email;
                document.getElementById('birthDate').value = member.birthDate;
                document.getElementById('address').value = member.address;
                document.getElementById('idCard').value = member.idCard;
                document.getElementById('password').value = member.password;
            })
            .catch(error => {
                console.error('Error fetching member data:', error);
            });

        // 處理表單提交事件
        document.getElementById('update-form').addEventListener('submit', function(event) {
            event.preventDefault();

            // 收集表單資料
            const updatedMemberData = {
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                birthDate: document.getElementById('birthDate').value,
                address: document.getElementById('address').value,
                idCard: document.getElementById('idCard').value,
                password: document.getElementById('password').value
            };

            // 發送 PUT 請求更新會員資料
            fetch(`${apiUrl2}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(updatedMemberData)
            })
            .then(response => response.json())
            .then(data => {
                alert('會員資料已更新');
                window.location.href = 'search.html'; // 更新完成後返回搜尋頁面
            })
            .catch(error => {
                alert('更新失敗');
                console.error('Error:', error);
            });
        });
    </script>

</body>
</html>
